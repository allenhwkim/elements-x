<h1 id="animate-with-javascript">Animate With Javascript</h1>
<p>There are two ways to do animation on browser; with CSS and with Javascript.</p>
<p>There are two ways to do animation on browser; with CSS and with Javascript.</p>
<p>CSS animation is built-in with browser and perform much cleaner and faster. However, you are not always satisfied with css animation as a programmer and you may complain for more CSS coding.</p>
<p>Javascript animation is not optimized for browser compared to CSS animation. However, you can control your coding as you want. To summarize;</p>
<ul>
<li><p>Use CSS animations for simple animation, e.g., slide in, slide out.</p>
</li>
<li><p>Use JavaScript animations for more advanced animations; e.g. bouncing, stop, pause, rewind, or slow down.</p>
</li>
</ul>
<h3 id="css-vs-javascript">CSS vs. Javascript.</h3>
<p>Some may say that CSS animation takes less code than Javascript. However, when it comes to fully satisfactory animation, it needs more CSS than Javascript.</p>
<p>Let’s take a look at <a href="https://gist.github.com/allenhwkim/575297aad6ae3761409e5dc9e9765363">this css animation</a>, which is for bouncing in. 40 lines of code is only for <code>bounce-in</code> from left side. When you need other animation you need to add another css code, for example, bounce in from right side, or acceleration, you need more css code, etc.</p>
<p>As I will demonstrate in this article later, the above code with Javascript is much less and cleaner than css, and it’s much ideal for coding perspective.</p>
<p>Furthermore, CSS animation can’t handle animation between <code>display:none</code> and <code>display:block</code>, which we use do so often. It can’t handle animation between <code>height: 0</code> and <code>height:auto</code> either.</p>
<p>To avoid CSS animation limits, many developers add another css property <code>opacity</code>, <code>visibility</code>, and <code>max-height</code> . Instead of going around, why don’t we use Javascript animation unless performance optimization is too important to you.</p>
<p>Ok, enough chit-chat regarding CSS and Javascript animation.</p>
<p>For more about CSS animation, MDN web pages have good information.</p>
<ul>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform">https://developer.mozilla.org/en-US/docs/Web/CSS/transform</a></p>
</li>
</ul>
<h2 id="lets-get-into-javascript-animation">Let’s get into Javascript animation.</h2>
<p>When we do animation with Javascript, we instruct browser to take an action one-by-one by using loop. There are two ways to instruct your browser; <code>setTimeout </code>and <code>requestAnimationFrame</code>. There is also <code>setInterval</code>, but I don’t think it’s a good way to use it for animation.</p>
<h3 id="settimeout-vs-requestanimationframe">setTimeout vs. requestAnimationFrame</h3>
<p>Here are two examples to make a controlled call for 10 times using <code>setTimeout</code> and <code>requestAnimationFrame</code>.</p>
<p>As you see below, the code looks very same although the behind the scene is very different.</p>
<p><img src="https://cdn-images-1.medium.com/max/5464/1*anUBg9PIoLSrvPpFK8npYA.png" alt="Run setTimeout 10 times"><em>Run setTimeout 10 times</em></p>
<p><img src="https://cdn-images-1.medium.com/max/5472/1*0gePBMk-STjdF_qNpbNTnA.png" alt="Run requestAnimationFrame 10 times"><em>Run requestAnimationFrame 10 times</em></p>
<p><code>setTimeout</code> only happens on the next execution cycle, which means if the browser is busy, it may happen on unexpected time. You may see some flickery animation when the browser is very busy.</p>
<p><code>[requestAnimationFrame</code>](<a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame</a>) is the standard way to perform animations. It performs its execution at the next repaint cycle, a frame, by accepting timestamp as a single argument.</p>
<p><code>window.requestAnimationFrame(callback);</code></p>
<blockquote>
<p>This will request that your animation function be called before the browser performs the next repaint. The number of callbacks is usually 60 times per second, but will generally match the display refresh rate in most web browsers as per W3C recommendation.</p>
</blockquote>
<h3 id="animate-function">animate() function</h3>
<p>Making use of <code>requestAnimation</code> frame, we can build a common animation function like as you might have done with setTimeout. Luckily, I have found a good one from <a href="https://javascript.info/js-animation#structured-animation">here</a>.</p>
<pre><code>function animate({**timing**, **draw**, **duration**}) {
  const start = performance.now();
  requestAnimationFrame(function animate(time) {
    let timeFraction = (time - start) / **duration**;
    if (timeFraction &gt; 1) timeFraction = 1;
    let **progress** = **timing(timeFraction)**
    **draw**(**progress**); // draw it
    if (timeFraction &lt; 1) requestAnimationFrame(animate);
  });
}</code></pre>
<ul>
<li><p><code>duration</code> – the total animation time in ms.</p>
</li>
<li><p><code>timing</code> – the function to calculate animation progress, which accepts the current time as an argument and returns a number between 0 and1.</p>
</li>
<li><p><code>draw</code> – The function to execute, which accepts the result of timing function, number between 0 and 1, as a progress.</p>
</li>
</ul>
<p>The following is the demo of the above <code>animate()</code> function.</p>
<pre><code>animate({
  **duration**: 2000,
  **timing**: function(t) { return t },
  **draw**: **pct** =&gt; {
    const air = document.querySelector(&#39;.air&#39;);
    const ball = document.querySelector(&#39;.ball&#39;);
    ball.style.left = **pct** * (air.offsetWidth-30) + &#39;px&#39;;
  }
});</code></pre>
<p>You can have your own timing function and draw function to make an improved animation such as ease-in, ease-out, ease-in-out, bouncing, acceleration, de-acceleration, etc.</p>
<h3 id="improvement-of-animate-function">Improvement of animate() function</h3>
<p>For readers’ convenience, here I have created an improved version. This provides more to the basic <code>animate()</code> function.</p>
<ul>
<li><p>Default timing function, <code>function(t) { return t; }</code></p>
</li>
<li><p>Default duration, 250 ms</p>
</li>
<li><p>Accepting a single draw function as an argument.</p>
</li>
<li><p>Timing function as string, e.g. <code>ease-in-out</code></p>
</li>
<li><p>Returns a Promise, so that we can do chaining action after animation. 
For example, 
<code>animate(pct=&gt; /*ANIMATION CODE*/).then(_=&gt; console.log(&#39;DONE&#39;)</code></p>
</li>
</ul>
<p>The following is the full code for this animation.</p>
<pre><code>// timing functions - easein etc
import {timings} from &#39;./timings.js&#39;;

export function animate({duration = 1000, timing, draw}) {
  // if we only have one argument as a function given
  (typeof arguments[0] === &#39;function&#39;) &amp;&amp; (draw = arguments[0]);

  // set timing function
  (typeof timing === &#39;string&#39;) &amp;&amp; (timing = timings[timing]);
  timing = timing || (t =&gt; t);

  const start = performance.now();
  return new Promise(function(resolve) {
    requestAnimationFrame(function animate(time) {
      let timeFraction = (time - start) / duration;
      (timeFraction &gt; 1) &amp;&amp; (timeFraction = 1);
      draw(timing(timeFraction));
      timeFraction &lt; 1 ? 
        requestAnimationFrame(animate) : resolve(true);
    });
  });
}</code></pre>
<p>You can find the timings function from <a href="https://gist.github.com/allenhwkim/1a79eed7fa0d1531b57a635a8ec26a8e">here</a>.</p>
<p>Here is the demo with the improved animate function and pre-defined timing functions.</p>
<p>The above animation is especially useful when you want to do animation between <code>display:none</code> and <code>display:block</code>, which is not supported by CSS animation.</p>
<p>To appear an element slowly,</p>
<pre><code>el.style.display = &#39;block&#39;;
`animate(pct=&gt; el.opacity = pct);`</code></pre>
<p>To disappear an element slowly,</p>
<pre><code>`animate(pct=&gt; el.opacity = 1-pct)
  .then(_ =&gt; el.style.display = &#39;none&#39;);`</code></pre>
<p>A 80-lines of simple JS library has been published with the above technique as named <a href="https://allenhwkim.github.io/jsanimation/#home">jsanimation</a>. Please take a look at it and experience how this technique can expand for your application.</p>
<p>If you like this technique, you may also like Vanilla JS coding version of UI components; custom elements.</p>
<p><a href="https://github.com/allenhwkim/html-custom-elements">https://github.com/allenhwkim/html-custom-elements</a></p>
<p>Happy coding :)</p>

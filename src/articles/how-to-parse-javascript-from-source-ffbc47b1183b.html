<div class="medium-article"><style>
          figure { margin: 16px 0;}
          img {max-width: 100%; max-height: 100%;}
          .layout-1 { max-width: 680px; }
          .layout-3 { max-width: 1192px; }
          .layout-5 { width: 100%; }
          .layout-6 { width: 30%;}
          .layout-7 { width: 30%;}</style>
<h1 class="title">How To Parse Javascript From Source</h1>
<p>This is a short version of how to parse Javascript from source. I am writing this tutorial mainly to explain how <a href="https://github.com/allenhwkim/ngentest">ngentest</a> is written. However, this will be also useful for who wants to know how to parse Javascript.</p>
<pre><b>class </b>Car {<br/>  constructor(make, model) {<br/>    <b>this</b>.make = make;<br/>    <b>this</b>.model = model;<br/>  }<br/><br/>  getName() {<br/>    console.log('color', this.make, this.model);<br/>    <b>return this</b>.make + " " + <b>this</b>.model;<br/>  }<br/>}</pre>
<p>On this tutorial, we will parse <span class="quote">car.js</span> to find out the following;</p>
<div class="list bulletin">constructor parameters; <span class="quote">make</span> and <span class="quote">model</span>, and and its statements</div>
<div class="list bulletin">function name, <span class="quote">getName</span>, and its statements</div>
<h2>First, Parse Javascript with acorn.</h2>
<pre>const Parser = require(‘acorn’).Parser;<br/>const fs = require('fs');</pre>
<pre>const source = fs.readFileSync('./car.js', 'utf8')<br/>const parsed = jsParser.parse(source);</pre>
<p>To see the parsed output of the above, please visit <a href="https://astexplore.net,">https://astexplore.net,</a> then copy paste the <span class="quote">Car</span> class code. I found the site is very useful when programming.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*r8ZprbWJfLGO92HGwV3gcg.png" /><figcaption></figcaption></figure></div>
<p>From the parsed info, you see two <span class="quote">MethodDefinition</span>s. The first one is <span class="quote">constuctor</span> method and the second one is <span class="quote">getName</span> method.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*g9KLUjZnOMmHLdrmci3wIw.png" /><figcaption></figcaption></figure></div>
<p>Before we start, find <span class="quote">ClassDeclaration</span> from parsed.</p>
<pre>const classDecl = parsed.body[0];</pre>
<h2>First, Get Constructor info.</h2>
<p>To get the <span class="quote">constructor</span> method definition, you need to find the node that has <span class="quote">constructor</span> kind.</p>
<pre>const ctrDef = <br/>  classDecl.body.body.find(node =><b> node.kind === 'constructor'</b>);</pre>
<p>To get parameters names of the constructor,</p>
<pre>const ctrParameters = <b>ctrDef.value.params</b>.map(el => <b>el.name</b>);</pre>
<p>To get code statements of the constructor,</p>
<pre>const ctrStatements = ctrDef.value.body;</pre>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*eMYReBI0qyttqPWY8H3R7g.png" /><figcaption></figcaption></figure></div>
<h2>Second, Get ‘getName’ method info.</h2>
<p>To get the <span class="quote">getName</span> method, you need to find the node that has <span class="quote">method</span> kind and its <span class="quote">name</span> is <span class="quote">getName</span></p>
<pre>const methodDef = classDecl.body.body.find(<br/>  node => (<b>node.kind === 'method'</b>) && (<b>node.key.name === 'getName'</b>)<br/>);</pre>
<p>To get parameters names of the method<span class="quote">getName</span>,</p>
<pre>const methodParameters = <b>methodDef.value.params</b>.map(el => el.name);</pre>
<p>To get code statements of the constructor,</p>
<pre>const methodStatements = methodDef.value.body;</pre>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*bU0cYzpg07ZU36MrMgMvbw.png" /><figcaption></figcaption></figure></div>
<p>To get further into the type of AST nodes, you can visit <a href="https://github.com/estree/estree/blob/master/es5.md">github estree</a>. Here are the types of AST, Abstract Syntax Tree, nodes.</p>
<p>* BreakStatement<br/>* Identifier<br/>* Literal<br/>* ThisExpression<br/>* ThrowStatement<br/>* ArrayExpression<br/>* ArrayPattern<br/>* ArrowFunctionExpression<br/>* BinaryExpression<br/>* BlockStatement<br/>* CatchClause<br/>* ConditionalExpression<br/>* ExpressionStatement<br/>* ForInStatement<br/>* ForOfStatement<br/>* ForStatement<br/>* FunctionExpression<br/>* IfStatement<br/>* LogicalExpression<br/>* NewExpression<br/>* ObjectExpression<br/>* ReturnStatement<br/>* SpreadElement<br/>* SwitchStatement<br/>* TemplateLiteral<br/>* TryStatement<br/>* UnaryExpression<br/>* UpdateExpression<br/>* VariableDeclaration<br/>* WhileStatement<br/>* WhileExpression<br/>* YieldExpression<br/>* AssignmentExpression<br/>* CallExpression<br/>* MemberExpression</p>
<p>To summarize, the following is full code from this tutorial. You can simply copy/paste to experience it, e.g. <span class="quote">parse-javascript.js</span></p>
<pre>const Parser = require('acorn').Parser;<br/>const fs = require('fs');</pre>
<pre>const parsed = Parser.parse(`<br/>class Car {<br/>  constructor(make, model) {<br/>    this.make = make;<br/>    this.model = model;<br/>  }</pre>
<pre>getName() {<br/>    console.log('color', this.make, this.model);<br/>    return this.make + " " + this.model;<br/>  }<br/>}`);</pre>
<pre>const classDecl = parsed.body[0];</pre>
<pre>const ctrDef = classDecl.body.body.find(node => node.kind === 'constructor');<br/>const ctrParams = ctrDef.value.params.map(el => el.name);<br/>const ctrStmts = ctrDef.value.body;</pre>
<pre>const methodDef = classDecl.body.body.find(<br/>  node => (node.kind === 'method') && (node.key.name === 'getName')<br/>);<br/>const methodParams = methodDef.value.params.map(el => el.name);<br/>const methodStmts = methodDef.value.body;</pre>
<pre>console.log({ ctrParams, ctrStmts, methodParams, methodStmts });</pre>
<p>When you run the above code, you will see the following;</p>
<pre>$ node ./parse-typescript.js<br/>{ ctrParams: [ 'make', 'model' ],<br/>  ctrStmts:<br/>   Node {<br/>     type: 'BlockStatement',<br/>     start: 40,<br/>     end: 91,<br/>     body: [ [Node], [Node] ] },<br/>  methodParams: [],<br/>  methodStmts:<br/>   Node {<br/>     type: 'BlockStatement',<br/>     start: 105,<br/>     end: 200,<br/>     body: [ [Node], [Node] ] } }</pre>
<p>Javascript parsing has been used to develop <a href="https://github.com/allenhwkim/ngentest">ngentest</a>, which creates Angular unit tests automatically, <a href="https://github.com/allenhwkim/ngentest">https://github.com/allenhwkim/ngentest</a>.</p>
<p><span class="quote">ngentest</span> is a Angular5, 6, 7, 8+ unit test generator for components, directives, services, and pipes, and it is heavily rely on Javascript AST parsing. As you read its ngentest README.md, it compiles Typescript to Javascript. then parse and get the following info.</p>
<div class="list bulletin">constructor param data</div>
<div class="list bulletin">provider mock data</div>
<div class="list bulletin">accessor tests</div>
<div class="list bulletin">function tests</div>
<div class="list bulletin">imports statements info.</div>
<p>Hope this helps someone.</p>
<p>Happy coding :)</p></div>
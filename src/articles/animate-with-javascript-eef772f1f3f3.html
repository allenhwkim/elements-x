<div class="medium-article"><style>
          figure { margin: 16px 0;}
          img {max-width: 100%; max-height: 100%;}
          .layout-1 { max-width: 680px; }
          .layout-3 { max-width: 1192px; }
          .layout-5 { width: 100%; }
          .layout-6 { width: 30%;}
          .layout-7 { width: 30%;}</style>
<h1>Simple Javascript Animation</h1>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*KpH1CErm8vV0ecMAfQ9yxA.png" /><figcaption></figcaption></figure></div>
<p>There are two ways to do animation on browser; with CSS and with Javascript.</p>
<p>CSS animation is built-in with browser and perform much cleaner and faster. However, you are not always satisfied with css animation as a programmer and you may complain for more CSS coding.</p>
<p>Javascript animation is not optimized for browser compared to CSS animation. However, you can control your coding as you want. To summarize;</p>
<div class="list bulletin">Use CSS animations for simple animation, e.g., slide in, slide out.</div>
<div class="list bulletin">Use JavaScript animations for more advanced animations; e.g. bouncing, stop, pause, rewind, or slow down.</div>
<h2>CSS vs. Javascript.</h2>
<p>Some may say that CSS animation takes less code than Javascript. However, when it comes to fully satisfactory animation, it needs more CSS than Javascript.</p>
<p>Let’s take a look at <a href="https://gist.github.com/allenhwkim/575297aad6ae3761409e5dc9e9765363">this css animation</a>, which is for bouncing in. 40 lines of code is only for <span class="quote">bounce-in</span> from left side. When you need other animation you need to add another css code, for example, bounce in from right side, or acceleration, you need more css code, etc.</p>
<p>As I will demonstrate in this article later, the above code with Javascript is much less and cleaner than css, and it’s much ideal for coding perspective.</p>
<p>Furthermore, CSS animation can’t handle animation between <span class="quote">display:none</span> and <span class="quote">display:block</span>, which we use do so often. It can’t handle animation between <span class="quote">height: 0</span> and <span class="quote">height:auto</span> either.</p>
<p>To avoid CSS animation limits, many developers add another css property <span class="quote">opacity</span>, <span class="quote">visibility</span>, and <span class="quote">max-height</span> . Instead of going around, why don’t we use Javascript animation unless performance optimization is too important to you.</p>
<p>Ok, enough chit-chat regarding CSS and Javascript animation.</p>
<p>For more about CSS animation, MDN web pages have good information.</p>
<div class="list bulletin"><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations</a></div>
<div class="list bulletin"><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform">https://developer.mozilla.org/en-US/docs/Web/CSS/transform</a></div>
<h1>Let’s get into Javascript animation.</h1>
<p>When we do animation with Javascript, we instruct browser to take an action one-by-one by using loop. There are two ways to instruct your browser; <span class="quote">setTimeout </span>and <span class="quote">requestAnimationFrame</span>. There is also <span class="quote">setInterval</span>, but I don’t think it’s a good way to use it for animation.</p>
<h2>setTimeout vs. requestAnimationFrame</h2>
<p>Here are two examples to make a controlled call for 10 times using <span class="quote">setTimeout</span> and <span class="quote">requestAnimationFrame</span>.</p>
<p>As you see below, the code looks very same although the behind the scene is very different.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-3"><img src="https://cdn-images-1.medium.com/max/700/1*anUBg9PIoLSrvPpFK8npYA.png" /><figcaption>Run setTimeout 10 times</figcaption></figure><figure class="layout-3"><img src="https://cdn-images-1.medium.com/max/700/1*0gePBMk-STjdF_qNpbNTnA.png" /><figcaption>Run requestAnimationFrame 10 times</figcaption></figure></div>
<p><span class="quote">setTimeout</span> only happens on the next execution cycle, which means if the browser is busy, it may happen on unexpected time. You may see some flickery animation when the browser is very busy.</p>
<p><span class="quote">requestAnimationFrame</span> is the standard way to perform animations. It performs its execution at the next repaint cycle, a frame, by accepting timestamp as a single argument.</p>
<p><span class="quote">window.requestAnimationFrame(callback);</span></p>
<blockquote>This will request that your animation function be called before the browser performs the next repaint. The number of callbacks is usually 60 times per second, but will generally match the display refresh rate in most web browsers as per W3C recommendation.</blockquote>
<h2>animate() function</h2>
<p>Making use of <span class="quote">requestAnimation</span> frame, we can build a common animation function like as you might have done with setTimeout. Luckily, I have found a good one from <a href="https://javascript.info/js-animation#structured-animation">here</a>.</p>
<pre>function animate({<b>timing</b>, <b>draw</b>, <b>duration</b>}) {<br/>  const start = performance.now();<br/>  requestAnimationFrame(function animate(time) {<br/>    let timeFraction = (time - start) / <b>duration</b>;<br/>    if (timeFraction > 1) timeFraction = 1;<br/>    let <b>progress</b> = <b>timing(timeFraction)</b><br/>    <b>draw</b>(<b>progress</b>); // draw it<br/>    if (timeFraction &lt; 1) requestAnimationFrame(animate);<br/>  });<br/>}</pre>
<div class="list bulletin"><span class="quote">duration</span> – the total animation time in ms.</div>
<div class="list bulletin"><span class="quote">timing</span> – the function to calculate animation progress, which accepts the current time as an argument and returns a number between 0 and1.</div>
<div class="list bulletin"><span class="quote">draw</span> – The function to execute, which accepts the result of timing function, number between 0 and 1, as a progress.</div>
<p>The following is the demo of the above <span class="quote">animate()</span> function.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fstackblitz.com%2Fedit%2Fjs-animate-basic%3Fembed%3D1%26file%3Dindex.js%26hideExplorer%3D1%26hideNavigation%3D1%26view%3Dpreview&url=https%3A%2F%2Fstackblitz.com%2Fedit%2Fjs-animate-basic%3Fembed%3D1%26file%3Dindex.js%26hideExplorer%3D1%26hideNavigation%3D1%26view%3Dpreview&image=https%3A%2F%2Fc.staticblitz.com%2Fassets%2Ficon-664493542621427cc8adae5e8f50d632f87aaa6ea1ce5b01e9a3d05b57940a9f.png&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=stackblitz" width="745" height="400"></iframe><figcaption></figcaption></figure></div>
<pre>animate({<br/>  <b>duration</b>: 2000,<br/>  <b>timing</b>: function(t) { return t },<br/>  <b>draw</b>: <b>pct</b> => {<br/>    const air = document.querySelector('.air');<br/>    const ball = document.querySelector('.ball');<br/>    ball.style.left = <b>pct</b> * (air.offsetWidth-30) + 'px';<br/>  }<br/>});</pre>
<p>You can have your own timing function and draw function to make an improved animation such as ease-in, ease-out, ease-in-out, bouncing, acceleration, de-acceleration, etc.</p>
<h2>Improvement of animate() function</h2>
<p>For readers’ convenience, here I have created an improved version. This provides more to the basic <span class="quote">animate()</span> function.</p>
<div class="list bulletin">Default timing function, <span class="quote">function(t) { return t; }</span></div>
<div class="list bulletin">Default duration, 250 ms</div>
<div class="list bulletin">Accepting a single draw function as an argument.</div>
<div class="list bulletin">Timing function as string, e.g. <span class="quote">ease-in-out</span></div>
<div class="list bulletin">Returns a Promise, so that we can do chaining action after animation. <br/>For example, <br/><span class="quote">animate(pct=> /*ANIMATION CODE*/).then(_=> console.log('DONE')</span></div>
<p>The following is the full code for this animation.</p>
<pre>// timing functions - easein etc<br/>import {timings} from './timings.js';</pre>
<pre>export function animate({duration = 1000, timing, draw}) {<br/>  // if we only have one argument as a function given<br/>  (typeof arguments[0] === 'function') && (draw = arguments[0]);</pre>
<pre>  // set timing function<br/>  (typeof timing === 'string') && (timing = timings[timing]);<br/>  timing = timing || (t => t);</pre>
<pre>  const start = performance.now();<br/>  return new Promise(function(resolve) {<br/>    requestAnimationFrame(function animate(time) {<br/>      let timeFraction = (time - start) / duration;<br/>      (timeFraction > 1) && (timeFraction = 1);<br/>      draw(timing(timeFraction));<br/>      timeFraction &lt; 1 ? <br/>        requestAnimationFrame(animate) : resolve(true);<br/>    });<br/>  });<br/>}</pre>
<p>You can find the timings function from <a href="https://gist.github.com/allenhwkim/1a79eed7fa0d1531b57a635a8ec26a8e">here</a>.</p>
<p>Here is the demo with the improved animate function and pre-defined timing functions.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fstackblitz.com%2Fedit%2Fjs-animate%3Fembed%3D1%26file%3Danimate.js%26hideNavigation%3D1%26view%3Dpreview&url=https%3A%2F%2Fstackblitz.com%2Fedit%2Fjs-animate%3Fembed%3D1%26file%3Danimate.js%26hideNavigation%3D1%26view%3Dpreview&image=https%3A%2F%2Fc.staticblitz.com%2Fassets%2Ficon-664493542621427cc8adae5e8f50d632f87aaa6ea1ce5b01e9a3d05b57940a9f.png&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=stackblitz" width="745" height="400"></iframe><figcaption></figcaption></figure></div>
<p>The above animation is especially useful when you want to do animation between <span class="quote">display:none</span> and <span class="quote">display:block</span>, which is not supported by CSS animation.</p>
<p>To appear an element slowly,</p>
<pre>el.style.display = 'block';<br/><span class="quote">animate(pct=> el.opacity = pct);</span></pre>
<p>To disappear an element slowly,</p>
<pre><span class="quote">animate(pct=> el.opacity = 1-pct)<br/>  .then(_ => el.style.display = 'none');</span></pre>
<p>A 80-lines of simple JS library has been published with the above technique as named <a href="https://allenhwkim.github.io/jsanimation/#home">jsanimation</a>. Please take a look at it and experience how this technique can expand for your application.</p>
<p>If you like this technique, you may also like Vanilla JS coding version of UI components; custom elements.</p>
<p><a href="https://github.com/allenhwkim/html-custom-elements">https://github.com/allenhwkim/html-custom-elements</a></p>
<p>Happy coding :)</p></div>
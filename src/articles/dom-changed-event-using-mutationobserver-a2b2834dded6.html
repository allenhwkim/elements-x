<div class="medium-article"><style>
          figure { margin: 16px 0;}
          img {max-width: 100%; max-height: 100%;}
          .layout-1 { max-width: 680px; }
          .layout-3 { max-width: 1192px; }
          .layout-5 { width: 100%; }
          .layout-6 { width: 30%;}
          .layout-7 { width: 30%;}</style>
<h1>Create `dom-changed` Event Using MutationObserver</h1>
<p>To track the change of any element in your document, there was an event called <span class="quote">DOMSubtreeModified</span>, but this is not encouraged to use.</p>
<p>Luckily, we have a new way to do it, <span class="quote">MutationObserver</span>, which is compatible with on almost all modern browsers including IE11.</p>
<p>Here I provide very simple example to detect any change in your document.</p>
<pre>const observer = <b>new MutationObserver</b>(list => {<br/>  console.log(‘mutation list’, list);<br/>});<br/><b>observer.observe</b>(document.body, {attributes: true, childList: true, subtree: true});<br/>// perform any DOM change action in your page. e.g. show/hide</pre>
<p>You copy/paste the above code into your console. Then you will see any DOM change events.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*TgNsev8jdQusqnjPJzVzVQ.png" /><figcaption></figcaption></figure></div>
<p>It works, yes it works, and it’s doable. However it seems something missing, and it’s not like any traditional event handling, e.g. click event handling.</p>
<p>Let’s change the above code to fire an event, <span class="quote">dom-changed, </span>so that any function can handle DOM event changes as an event.</p>
<p>It’s pretty simple. Instead of logging to console, fire a custom event from <span class="quote">document.body.</span></p>
<pre>const observer = <b>new MutationObserver</b>( list => {<br/>  const evt = new CustomEvent('<b>dom-changed</b>', {detail: list});<br/>  <b>document.body.dispatchEvent(evt)</b><br/>});<br/><b>observer.observe</b>(document.body, {attributes: true, childList: true, subtree: true});</pre>
<p>Now you can do to listen to any DOM change event in your body.</p>
<pre>document.body.addEventListener('<b>dom-changed</b>', e => console.log(e));</pre>
<p>Here is console message for the above code.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*uHwHQidCvFl35S1xOA4dZA.png" /><figcaption></figcaption></figure></div>
<p>This technique can be used to make a Promise response to wait for certain DOM contents instead of using <span class="quote">setTimeout</span>, or polling. As an example, let’s code a Promise function that waits for body text to have ‘Hello World’.</p>
<pre>function waitForText(el, text, maxWait=5000) {<br/>  return new Promise(function(resolve, reject) {</pre>
<pre>    setTimeout(_ => { // when timeout, fail<br/>      document.body.removeEventListener('dom-changed', checkFn);<br/>      reject('Error finding text');<br/>    }, maxWait);</pre>
<pre>    const checkFn = function() {<br/>      if (el.innerText.includes(text)) {<br/>        document.body.removeEventListener('dom-changed', checkFn);<br/>        resolve(true);<br/>      }<br/>    };</pre>
<pre>    document.body.addEventListener('dom-changed', checkFn);<br/>  })<br/>}</pre>
<p>Hope it helps</p>
<p>Happy coding :)</p></div>
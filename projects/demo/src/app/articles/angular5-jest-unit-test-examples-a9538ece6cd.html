<style>
          figure { margin: 16px 0;}
          img {max-width: 100%; max-height: 100%;}
          .layout-1 { max-width: 680px; }
          .layout-3 { max-width: 1192px; }
          .layout-5 { width: 100%; }
          .layout-6 { width: 30%;}
          .layout-7 { width: 30%;}</style>
<h1 class="title">Angular5+ Jest Unit Test Examples</h1>
<p>This is my note of Angular5+ Component/Directory/Service tess with Jest.</p>
<p>This same technique has been applied to my automatic test generator. If you feel itâ€™s too much to write tests, you should read this to save your time.</p>
<p><a href="https://medium.com/allenhwkim/generate-angular-unit-tests-automatically-1300601ed73">https://medium.com/allenhwkim/generate-angular-unit-tests-automatically</a></p>
<h2>Component Test</h2>
<p>app.component</p>
<pre>import { Component } from '<a href="http://twitter.com/angular/core">@angular/core</a>';</pre>
<pre><a href="http://twitter.com/Component">@Component</a>({
  selector: 'app-root',
  template: `
    &lt;h1>Welcome to app.&lt;/h1>
    &lt;my-component-1>&lt;/my-component-1>
    &lt;my-component-2>&lt;/my-component-2>
`
})
export class AppComponent {
  message: string;
  title = 'app';
}</pre>
<p>jest-setup.ts</p>
<pre>import { Component } from '<a href="http://twitter.com/angular/core">@angular/core</a>';</pre>
<pre>/**
 * Examples:
 * MockComponent({selector: 'some-component'});
 * MockComponent({selector: 'some-component', inputs: ['some-input', 'some-other-input']});
 */
export function <b>MockComponent</b>(selector, options = {}) Component {</pre>
<pre>  const metadata: Component = {
    selector,
    template: options.template || '',
    inputs: options.inputs || [],
    outputs: options.outputs || [],
    exportAs: options.exportAs || ''
  };</pre>
<pre>  class Mock {
    constructor() {
      metadata.outputs.forEach(method => {
        this[method] = new EventEmitter&lt;any>();
      });
    }
  }</pre>
<pre>  return Component(metadata)(Mock as any);
}</pre>
<p>app.component.spec.ts</p>
<pre>import { async, TestBed } from '@angular/core/testing';
import { NO_ERRORS_SCHEMA } from '@angular/core';

// do not import any other than you test. For others, mock it
import { AppComponent } from './app.component';
import { MockComponent } from '../../test/jest-setup';

describe('AppComponent', () => {
  var fixture, component;

  beforeEach(async(() => {
    TestBed.configureTestingModule({
      declarations: [
        AppComponent,
        MockComponent('my-component-1'),
        MockComponent('my-component-2')
      ]
      // schemas: [NO_ERRORS_SCHEMA]
    }).compileComponents();
    fixture = TestBed.createComponent(AppComponent);
    component = fixture.debugElement.componentInstance;
  }));

  it('should create the app', async(() => {
    expect(component).toBeTruthy();
    expect(copmponent.title).toEqual('app');
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    const h1 = compiled.querySelector('h1');
    expect(h1.textContent).toContain('Welcome to app!');
  }));

});</pre>
<h2>Directive Test</h2>
<blockquote>Reference. <a href="https://codecraft.tv/courses/angular/unit-testing/directives/">https://codecraft.tv/courses/angular/unit-testing/directives/</a></blockquote>
<p>my.directive.ts</p>
<pre><a href="http://twitter.com/Directive">@Directive</a>({
  selector: '[foo], [bar]'
})
export class MyDirective {
  <a href="http://twitter.com/Output">@Output</a>() foo: EventEmitter&lt;any> = new EventEmitter();
  <a href="http://twitter.com/Output">@Output</a>() bar: EventEmitter&lt;any> = new EventEmitter();</pre>
<pre>  constructor(
    public element: ElementRef,
    public renderer: Renderer2) {
  }</pre>
<pre>  ngOnInit() {
    this.foo.emit(1);
    this.bar.emit(2);
  }
}</pre>
<p>my.directive.spec.ts</p>
<pre>import { async, ComponentFixture, TestBed } 
  from '@angular/core/testing';
import { Component, NO_ERRORS_SCHEMA } from '@angular/core';

// Do not import any other than you test. For others, mock it
import { MyDirective } from './my.directive';

@Component({
  template: `&lt;div (foo)="a($event)" (bar)="b($event)">`
})
class TestComponent {
  a(entry): void {/* */}
  b(entry): void {/* */}
}

describe('MyDirective Test', () => {
  let fixture: ComponentFixture&lt;TestComponent>;
  let component: TestComponent;

  beforeEach(async(() => {
    TestBed.configureTestingModule({
      declarations: [ MyDirective, TestComponent ]
      // schemas: [NO_ERRORS_SCHEMA]
    }).compileComponents();
    fixture = TestBed.createComponent(TestComponent);
    component = fixture.componentInstance;
  }));

  it("should test", async(() => {
    expect(component).toBeTruthy();
    expect(copmponent.title).toEqual('app');
    fixture.detectChanges();
    const compiled = fixture.debugElement.nativeElement;
    const h1 = compiled.querySelector('h1');
    expect(h1.textContent).toContain('Welcome to app!');
  }));

});</pre>
<h2>Service Test</h2>
<p>my.service.ts</p>
<pre>import { Injectable } from '@angular/core';
import { SomeService } from './some.service';

@Injectable()
export class SomeService {

  constructor(private someService: SomeService) {}

  getValue(): any {
    return this.someService.getValue();
  }

}</pre>
<p>my.service.spec.ts</p>
<pre>// do not import any other than you test. For others, mock it
import { MyService } from './master.service';

describe('MyService', () => {
  let service;
  let someService;
  class SomeService {
    getValue = function() {};
  }

  beforeEach(() => {
    someService = new SomeService();
    service = new MyService(someService);
  });

  it('#getValue should return value', () => {
    const spy = jest.spyOn(someService, 'getValue');
    spy.mockReturnValue('stub value');

    expect(service.getValue()).toBe('stub value');
    expect(spy).toHaveBeenCalled();
  });
});</pre>
<blockquote>For http test, look at this. <a href="https://izifortune.com/unit-testing-angular-applications-with-jest/">https://izifortune.com/unit-testing-angular-applications-with-jest/</a></blockquote>
<li class="bulletin">For more detailed code at <a href="https://github.com/allenhwkim/ngx-module-starter">https://github.com/allenhwkim/ngx-module-starter</a></li>
<li class="bulletin">For jest setup code at: <a href="https://gist.github.com/allenhwkim/42b7388efa9e80a02d8b115aa5d2e2d7#file-jest-setup-ts">jest-setup.ts</a></li>
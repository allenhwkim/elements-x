<div class="medium-article"><style>
          figure { margin: 16px 0;}
          img {max-width: 100%; max-height: 100%;}
          .layout-1 { max-width: 680px; }
          .layout-3 { max-width: 1192px; }
          .layout-5 { width: 100%; }
          .layout-6 { width: 30%;}
          .layout-7 { width: 30%;}</style>
<h1 class="title">Dynamic Image Loading With Angular</h1>
<h2 class="subtitle">The simplest way to lazy load DOM elements within page with Angular</h2>
<p>Let‚Äôs assume that there are 100+ images on your page, and you only see two or three of them when the page loads. Then, why browsers load 100 images when the page initializes?</p>
<p>There is no way not to load image as long as there are <img> tag in your html. This means you have to change html not to have image tags and change html dynamically to avoid initial image loading. However, changing html dynamically is not an easy task, and it requires a lot of scripting.</p>
<p>Fortunately, Angular has its own way to do this task using <span class="quote">ng-container</span> and <span class="quote">ngTemplateOutlet</span>. The way to achieve to this goal is also to use HTML5 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API">IntersectionObserver</a>. I am not going to explain how <span class="quote">ng-container</span> and <span class="quote">ngTemplateOutlet</span> works. About those, please learn from the following sites; <a href="https://angular.io/guide/structural-directives">Angular ‚Äî Structural Directives</a> and <a href="https://blog.angular-university.io/angular-ng-template-ng-container-ngtemplateoutlet/">The Complete Guide To Angular Templates</a></p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><img src="https://cdn-images-1.medium.com/max/700/1*HW879ydGhKsXkXS4bRzmdg.png" /><figcaption></figcaption></figure></div>
<p>To make a long story short. This is the angular html code, and this is the working demo; <a href="https://ngui-in-view-basic.stackblitz.io/">https://ngui-in-view-basic.stackblitz.io/</a></p>
<pre>&lt;hr/><br/>List Of Images<br/>&lt;hr/></pre>
<pre>&lt;div *ngFor="let i of numArr"><br/>  &lt;<b>ngui-in-view</b>><br/>    &lt;img <b>*ngIf</b> src="https://picsum.photos/800/300?image={{i}}><br/>  &lt;/ngui-in-view><br/>&lt;/div></pre>
<p>The full example is here at <a href="https://stackblitz.com/edit/ngui-in-view-basic">https://stackblitz.com/edit/ngui-in-view-basic</a></p>
<p>The above code will not load any image unless you see it. There are two things to notice; <ngui-in-view> and *ngIf.</p>
<div class="list bulletin"><span class="quote">&lt;ngui-in-view></span>: A custom component to show the contents only if in view.</div>
<div class="list bulletin"><span class="quote">*ngIf</span>: this will generate <span class="quote">ng-template</span> internally, which Angular does not render unless condition meets.</div>
<p>First, lets take a look at <span class="quote">&lt;ngui-in-view></span> component.</p>
<div style="display:flex; flex-wrap: wrap"><figure class="layout-1"><iframe data-script="https://gist.github.com/allenhwkim/4f87ee848043e88a92d61124b85b369e.js" style="display:none; max-width: 100%; border: 0" width="225" title="Simple Lazy Loading With Angular"></iframe>
                <script src="https://gist.github.com/allenhwkim/4f87ee848043e88a92d61124b85b369e.js"></script><figcaption></figcaption></figure></div>
<p>To explain the above code,</p>
<pre>ngOnInit(): void {<br/>  if (isPlatformBrowser(this.platformId)) {<br/>    this.observer = new<br/>      IntersectionObserver(this.handleIntersect.bind(this), this.options);<br/>    this.observer.observe(this.element.nativeElement);<br/>  }<br/>}</pre>
<p>When a component is initialized, it will register an IntersectionObserver, so that when element is visible, it calls the callback <span class="quote">handleIntersect</span>.</p>
<pre>handleIntersect(entries, observer): void {<br/>  entries.forEach((entry: IntersectionObserverEntry) => {<br/>    if (entry.isIntersecting) {<br/>      this.inView = true;<br/>      this.inView$.emit(entry);<br/>      // this.defaultInViewHandler(entry);<br/>    } else {<br/>      this.notInView$.emit(entry);<br/>    }<br/>  });<br/>}</pre>
<p>The observer callback <span class="quote">handleIntersect</span> sets <span class="quote">inView</span> to <span class="quote">true</span> and fires <span class="quote">inView$</span> event when the element is visible and fires <span class="quote">notInView$</span> event when the element is not visible.</p>
<pre><span class="quote">@ContentChild(TemplateRef) template: TemplateRef&lt;any>;</span></pre>
<p>It‚Äôs the reference to <span class="quote">&lt;ng-template></span> tag. In this example it‚Äôs <span class="quote">*ngIf</span>.<br/><span class="quote">&lt;div *ngIf>1&lt;div></span> is the same as <span class="quote">&lt;ng-template [ngIf]="">1&lt;ng-template></span> .</p>
<pre>@Component({<br/>  selector: 'ngui-in-view',<br/>  template: `<br/>    &lt;ng-container *ngIf="inView" [ngTemplateOutlet]="template"><br/>    &lt;/ng-container><br/>  `<br/>})</pre>
<p><span class="quote">ng-container</span> will show the template; <span class="quote">&lt;img *ngIf src=‚Äùhttps://picsum.photos/800/300?image={{i}}" height=‚Äù33%‚Äù</span>, specified by <span class="quote">ngTemplateOutlet</span> when <span class="quote">inView</span> is true, which means when element is visible.</p>
<p>Visiting <span class="quote">app.component.html</span> again, there are 100s of images, and only visible elements will be downloaded and displayed.</p>
<pre>&lt;div *ngFor="let i of numArr"><br/>  &lt;<b>ngui-in-view</b>><br/>    &lt;img <b>*ngIf</b> src="https://picsum.photos/800/300?image={{i}}><br/>  &lt;/ngui-in-view><br/>&lt;/div></pre>
<p>You can see the full code here. <a href="https://stackblitz.com/edit/ngui-in-view-basic">https://stackblitz.com/edit/ngui-in-view-basic</a></p>
<p>Next article will deal with virtual list, not infinite list, which will expand this concept. You can see the preview of virtual list at <a href="https://stackblitz.com/edit/ngui-in-view-virtual-list">here</a></p>
<p>Happy coding,<br/>and happy Angular</p>
<p>Allen Kim</p>
<p><b>Do you think this useful? If so please;<br/>*</b> <b>Clap üëè button </b>belowÔ∏è to let others to see this too.<br/>* <a href="https://twitter.com/allenhwkim">Follow Allen on Twitter (@allenhwkim)</a></p></div>